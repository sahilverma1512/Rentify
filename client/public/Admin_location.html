<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Admin_department_office/Admin_location.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Locations</title>
    <style>
         .hover-image {
            /* height: 200px; */
            position: absolute;
            display: none;
            /* border: 1px solid rgb(98, 221, 243);
            background-color: rgb(222, 249, 248); */
            /* padding: 5px; */
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <!-- Map container -->
    <div id="map-container"></div>
    <div class="hover-image" id="hover-image">
    </div>
    <script>
        let map;

        function initMap() {
            // Use geolocation to get the current position
            navigator.geolocation.getCurrentPosition(function (position) {
                const currentLocation = new Microsoft.Maps.Location(position.coords.latitude, position.coords.longitude);

                map = new Microsoft.Maps.Map(document.getElementById('map-container'), {
                    credentials: 'ArSGwElpgs65UXUwCnZ4ibhLzkmxuScTxz0rCq_kgJy35pa2tSq229GIMzMPVQ8P',
                    center: currentLocation, // Set the center of the map to current location
                    zoom: 12 // Set initial zoom level
                });

                fetchCoordinates();
            });
        }

        function fetchCoordinates() {
            fetch('/getLocation')
                .then(response => response.json())
                .then(data => {
                    const filteredData = data.filter(entry => entry.complete !== true && entry.reject === false);
                    filteredData.forEach(entry => {
                        const latitude = parseFloat(entry.latitude);
                        const longitude = parseFloat(entry.longitude);
                        if (isValidCoordinate(latitude) && isValidCoordinate(longitude)) {
                            plotCoordinate(latitude, longitude, entry); // Pass entry data to plotCoordinate function
                        } else {
                            console.error(`Invalid coordinate: latitude ${latitude}, longitude ${longitude}`);
                        }
                    });
                })
                .catch(error => console.error('Error fetching coordinates:', error));
        }

        function isValidCoordinate(coordinate) {
            return !isNaN(coordinate) && coordinate >= -90 && coordinate <= 90;
        }

        function plotCoordinate(latitude, longitude, entry) {
            const location = new Microsoft.Maps.Location(latitude, longitude);
            const pin = new Microsoft.Maps.Pushpin(location, {
                color: 'blue' // Set color of the pushpin to blue
            });

            // Add mouseover event listener to the pin
            Microsoft.Maps.Events.addHandler(pin, 'mouseover', function (e) {
                const hoverImage = document.getElementById('hover-image');
                hoverImage.style.display = 'block';
                hoverImage.style.left = `${e.pageX}px`;
                hoverImage.style.top = `${e.pageY}px`; 
                hoverImage.innerHTML = `<img src="${entry.imagePath}" alt="Image" width="100px" style="border-radius:10px;" >`; // Display image
            });

            // Add mouseout event listener to hide the image
            Microsoft.Maps.Events.addHandler(pin, 'mouseout', function () {
                document.getElementById('hover-image').style.display = 'none';
            });

            // Add click event listener to the pin
            Microsoft.Maps.Events.addHandler(pin, 'click', function () {
                // Zoom in on the clicked pin
                map.setView({ center: location, zoom: 15 }); // Zoom level set to 15 for closer view
            });

            map.entities.push(pin);
        }

        document.getElementById('menu-icon').addEventListener('click', function() {
    const menuOptions = document.getElementById('menu-options');

    if (menuOptions.style.display === 'none' || menuOptions.style.display === '') {
        menuOptions.style.display = 'block';
    } else {
        menuOptions.style.display = 'none';
    }
});

document.addEventListener('click', function(event) {
    const menuOptions = document.getElementById('menu-options');
    const menuIcon = document.getElementById('menu-icon');

    if (!menuOptions.contains(event.target) && event.target !== menuIcon) {
        menuOptions.style.display = 'none';
    }
});
    </script>
    <script type="text/javascript"
        src="https://www.bing.com/api/maps/mapcontrol?key=ArSGwElpgs65UXUwCnZ4ibhLzkmxuScTxz0rCq_kgJy35pa2tSq229GIMzMPVQ8P&callback=initMap"
        async defer></script>
</body>

</html>